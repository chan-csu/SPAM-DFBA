
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Installation/">
      
      
        <link rel="next" href="../case_studies_Starch_Amylase.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>API - SPAM-DFBA</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SPAM-DFBA" class="md-header__button md-logo" aria-label="SPAM-DFBA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SPAM-DFBA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SPAM-DFBA" class="md-nav__button md-logo" aria-label="SPAM-DFBA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SPAM-DFBA
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Main
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#toolkit" class="md-nav__link">
    toolkit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit" class="md-nav__link">
    spamdfba.toolkit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent" class="md-nav__link">
    Agent
  </a>
  
    <nav class="md-nav" aria-label="Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.compute_rtgs" class="md-nav__link">
    compute_rtgs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.get_actions" class="md-nav__link">
    get_actions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment" class="md-nav__link">
    Environment
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.extract_species" class="md-nav__link">
    extract_species()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.resolve_exchanges" class="md-nav__link">
    resolve_exchanges()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.resolve_extracellular_reactions" class="md-nav__link">
    resolve_extracellular_reactions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.set_networks" class="md-nav__link">
    set_networks()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.set_observables" class="md-nav__link">
    set_observables()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.NN" class="md-nav__link">
    NN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation" class="md-nav__link">
    Simulation
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.plot_learning_curves" class="md-nav__link">
    plot_learning_curves()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.print_training_times" class="md-nav__link">
    print_training_times()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Build_Mapping_Matrix" class="md-nav__link">
    Build_Mapping_Matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.general_kinetic" class="md-nav__link">
    general_kinetic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.general_uptake" class="md-nav__link">
    general_uptake()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.mass_transfer" class="md-nav__link">
    mass_transfer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.rollout" class="md-nav__link">
    rollout()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.run_episode" class="md-nav__link">
    run_episode()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.run_episode_single" class="md-nav__link">
    run_episode_single()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toymodel" class="md-nav__link">
    toymodel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stats" class="md-nav__link">
    Stats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats" class="md-nav__link">
    spamdfba.stats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult" class="md-nav__link">
    StatResult
  </a>
  
    <nav class="md-nav" aria-label="StatResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult.anova" class="md-nav__link">
    anova()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult.box_plot" class="md-nav__link">
    box_plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats.compare_observations" class="md-nav__link">
    compare_observations()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability" class="md-nav__link">
    Scalability
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../case_studies_Starch_Amylase.html" class="md-nav__link">
        Case Study - Starch Amylase
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../case_studies_NECOM.html" class="md-nav__link">
        Case Study - Toy NECom
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../case_studies_ecoli_GEM.html" class="md-nav__link">
        Case Study - Ecoli GEM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../stats.html" class="md-nav__link">
        Statistical Analysis
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#toolkit" class="md-nav__link">
    toolkit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit" class="md-nav__link">
    spamdfba.toolkit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent" class="md-nav__link">
    Agent
  </a>
  
    <nav class="md-nav" aria-label="Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.compute_rtgs" class="md-nav__link">
    compute_rtgs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Agent.get_actions" class="md-nav__link">
    get_actions()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment" class="md-nav__link">
    Environment
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.extract_species" class="md-nav__link">
    extract_species()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.resolve_exchanges" class="md-nav__link">
    resolve_exchanges()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.resolve_extracellular_reactions" class="md-nav__link">
    resolve_extracellular_reactions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.set_networks" class="md-nav__link">
    set_networks()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.set_observables" class="md-nav__link">
    set_observables()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Environment.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.NN" class="md-nav__link">
    NN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation" class="md-nav__link">
    Simulation
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.plot_learning_curves" class="md-nav__link">
    plot_learning_curves()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.print_training_times" class="md-nav__link">
    print_training_times()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Simulation.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.Build_Mapping_Matrix" class="md-nav__link">
    Build_Mapping_Matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.general_kinetic" class="md-nav__link">
    general_kinetic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.general_uptake" class="md-nav__link">
    general_uptake()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.mass_transfer" class="md-nav__link">
    mass_transfer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.rollout" class="md-nav__link">
    rollout()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.run_episode" class="md-nav__link">
    run_episode()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.toolkit.run_episode_single" class="md-nav__link">
    run_episode_single()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toymodel" class="md-nav__link">
    toymodel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stats" class="md-nav__link">
    Stats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats" class="md-nav__link">
    spamdfba.stats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult" class="md-nav__link">
    StatResult
  </a>
  
    <nav class="md-nav" aria-label="StatResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult.anova" class="md-nav__link">
    anova()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spamdfba.stats.StatResult.box_plot" class="md-nav__link">
    box_plot()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spamdfba.stats.compare_observations" class="md-nav__link">
    compare_observations()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability" class="md-nav__link">
    Scalability
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api">API</h1>
<p>SPAM-DFBA is implemented in Python. As of now, this library comes with two modules: toymodel.py and toolkit.py</p>
<p>toymodel.py includes toy examples used in the paper and it is mainly created for testing and playing with the algorithm. Most of the case studies import models from this module.</p>
<p>Toolkit on the other hand, provides all the required functionalities to run the RL simulations. You can simply create new cases that suit your purpose.</p>
<p>We first explain the toolkit module and then will explain how we can build an agent and an environment using the toy models that already exist in the toymodel module.</p>
<h2 id="toolkit">toolkit</h2>
<p>toolkit module offers a modular and hierarchical design:</p>
<p>1- First we need to define all the agents. Each agent is an instance of Agent class</p>
<p>2- An environment is defined by feeding the agents and providing some characteristics for the simulation environment. An environment object is instantiated from the Environment class</p>
<p>3- After defining the environment, we feed the environment object into a Simulation instance. This simulation instance decides on high-level variables such as where to save the files and plotting the results or obtaining the simulation times. The following figure describes the order of operation:</p>
<p><img alt="API" src="../API.png" /></p>


<div class="doc doc-object doc-module">


<a id="spamdfba.toolkit"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="spamdfba.toolkit.Agent" class="doc doc-heading">
        <code>Agent</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>An object of this class defines an agent in the environment. At the core of an agent lies a COBRA model.
Also the observable environment states are needed to be defined for an agent. Additionally, it should be defined what 
reactions an agent have control over.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A descriptive name given to an agent.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>cobra.<span title="cobra.Model">Model</span></code>
          </td>
          <td><p>A cobra model describing the metabolism of the agent.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>actor_network</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="spamdfba.toolkit.NN" href="#spamdfba.toolkit.NN">NN</a></code>
          </td>
          <td><p>The neural network class, pyTorch, to be used for the actor network.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>critic_network</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="spamdfba.toolkit.NN" href="#spamdfba.toolkit.NN">NN</a></code>
          </td>
          <td><p>The neural network class, pyTorch, to be used for the critic network.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer_critic</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Adam">Adam</span></code>
          </td>
          <td><p>The Adam optimizer class used for tuning the critic network parameters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer_actor</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Adam">Adam</span></code>
          </td>
          <td><p>The Adam optimizer class used for tuning the actor network parameters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>actions</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of reaction names that the agent has control over. The reactions should exist in the cobra model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>observables</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of the names of metabolites that the agents can sense from the environment.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>clip</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>gradient clipping threshhold that is used in PPO algorithm</p></td>
          <td>
                <code>0.01</code>
          </td>
        </tr>
        <tr>
          <td><code>actor_var</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of variance in the actor network suggestions. For exploration purpose. </p></td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>grad_updates</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>How many steps of gradient decent is performed in each training step</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>lr_actor</code></td>
          <td>
                <code>float) </code>
          </td>
          <td><p>The learning rate for the actor network </p></td>
          <td>
                <code>0.001</code>
          </td>
        </tr>
        <tr>
          <td><code>lr_critic</code></td>
          <td>
                <code>float) </code>
          </td>
          <td><p>The learning rate for the critic network </p></td>
          <td>
                <code>0.001</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spamdfba</span> <span class="kn">import</span> <span class="n">toymodels</span> <span class="k">as</span> <span class="n">tm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spamdfba</span> <span class="kn">import</span> <span class="n">toolkit</span> <span class="k">as</span> <span class="n">tk</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent1</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;agent1&quot;</span><span class="p">,</span>
<span class="go">    model=tm.ToyModel_SA.copy(),</span>
<span class="go">    actor_network=tk.NN,</span>
<span class="go">    critic_network=tk.NN,</span>
<span class="go">    clip=0.1,</span>
<span class="go">    lr_actor=0.0001,</span>
<span class="go">    lr_critic=0.001,</span>
<span class="go">    grad_updates=4,</span>
<span class="go">    optimizer_actor=torch.optim.Adam,</span>
<span class="go">    optimizer_critic=torch.optim.Adam,</span>
<span class="go">    observables=[&#39;agent1&#39;,&#39;agent2&#39; ,&#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="go">    actions=[&quot;Amylase_e&quot;],</span>
<span class="go">    gamma=1,</span>
<span class="go">    )</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Agent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; An object of this class defines an agent in the environment. At the core of an agent lies a COBRA model.</span>
<span class="sd">        Also the observable environment states are needed to be defined for an agent. Additionally, it should be defined what </span>
<span class="sd">        reactions an agent have control over.</span>


<span class="sd">        Args:</span>
<span class="sd">            name (str): A descriptive name given to an agent.</span>
<span class="sd">            model (cobra.Model): A cobra model describing the metabolism of the agent.</span>
<span class="sd">            actor_network (NN): The neural network class, pyTorch, to be used for the actor network.</span>
<span class="sd">            critic_network (NN): The neural network class, pyTorch, to be used for the critic network.</span>
<span class="sd">            optimizer_critic (torch.optim.Adam): The Adam optimizer class used for tuning the critic network parameters.</span>
<span class="sd">            optimizer_actor (torch.optim.Adam): The Adam optimizer class used for tuning the actor network parameters.</span>
<span class="sd">            actions (list): list of reaction names that the agent has control over. The reactions should exist in the cobra model.</span>
<span class="sd">            observables (list): list of the names of metabolites that the agents can sense from the environment.</span>
<span class="sd">            clip (float): gradient clipping threshhold that is used in PPO algorithm</span>
<span class="sd">            actor_var (float): Amount of variance in the actor network suggestions. For exploration purpose. </span>
<span class="sd">            grad_updates (int): How many steps of gradient decent is performed in each training step</span>
<span class="sd">            lr_actor (float) : The learning rate for the actor network </span>
<span class="sd">            lr_critic (float) : The learning rate for the critic network </span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from spamdfba import toymodels as tm</span>
<span class="sd">            &gt;&gt;&gt; from spamdfba import toolkit as tk</span>
<span class="sd">            &gt;&gt;&gt; agent1=tk.Agent(&quot;agent1&quot;,</span>
<span class="sd">                model=tm.ToyModel_SA.copy(),</span>
<span class="sd">                actor_network=tk.NN,</span>
<span class="sd">                critic_network=tk.NN,</span>
<span class="sd">                clip=0.1,</span>
<span class="sd">                lr_actor=0.0001,</span>
<span class="sd">                lr_critic=0.001,</span>
<span class="sd">                grad_updates=4,</span>
<span class="sd">                optimizer_actor=torch.optim.Adam,</span>
<span class="sd">                optimizer_critic=torch.optim.Adam,</span>
<span class="sd">                observables=[&#39;agent1&#39;,&#39;agent2&#39; ,&#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="sd">                actions=[&quot;Amylase_e&quot;],</span>
<span class="sd">                gamma=1,</span>
<span class="sd">                )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                <span class="n">model</span><span class="p">:</span><span class="n">cobra</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
                <span class="n">actor_network</span><span class="p">:</span><span class="n">NN</span><span class="p">,</span>
                <span class="n">critic_network</span><span class="p">:</span><span class="n">NN</span><span class="p">,</span>
                <span class="n">optimizer_critic</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">,</span>
                <span class="n">optimizer_actor</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">,</span>
                <span class="n">actions</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                <span class="n">observables</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                <span class="n">gamma</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                <span class="n">clip</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">actor_var</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">grad_updates</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">lr_actor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                <span class="n">lr_critic</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_critic</span> <span class="o">=</span> <span class="n">optimizer_critic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_actor</span> <span class="o">=</span> <span class="n">optimizer_actor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">observables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general_uptake_kinetics</span><span class="o">=</span><span class="n">general_uptake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clip</span> <span class="o">=</span> <span class="n">clip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor_var</span> <span class="o">=</span> <span class="n">actor_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_actor</span> <span class="o">=</span> <span class="n">lr_actor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_critic</span> <span class="o">=</span> <span class="n">lr_critic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad_updates</span> <span class="o">=</span> <span class="n">grad_updates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor_network</span> <span class="o">=</span> <span class="n">actor_network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critic_network</span> <span class="o">=</span> <span class="n">critic_network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov_var</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">),),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov_mat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_var</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">observation</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This method will draw the actions from a normal distribution around the actor netwrok prediction.</span>
<span class="sd">        The derivatives are not calculated here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_network_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="c1"># dist = MultivariateNormal(mean, self.actor_var)(mean, self.cov_mat)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_var</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="n">log_prob</span> <span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>        <span class="c1"># log_prob = dist.log_prob(action)</span>
        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">log_prob</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_obs</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">,</span><span class="n">batch_acts</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Calculates the value of the states, as well as the log probability af the actions that are taken.</span>
<span class="sd">        The derivatives are calculated here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic_network_</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_network_</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">)</span>
        <span class="c1"># dist = MultivariateNormal(mean, self.cov_mat)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_var</span><span class="p">)</span>
        <span class="n">log_probs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">V</span><span class="p">,</span> <span class="n">log_probs</span> 

    <span class="k">def</span> <span class="nf">compute_rtgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_rews</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a batch of rewards , it calculates the discouted return for each state for that batch&quot;&quot;&quot;</span>

        <span class="n">batch_rtgs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ep_rews</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">batch_rews</span><span class="p">):</span>
            <span class="n">discounted_reward</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># The discounted reward so far</span>
            <span class="k">for</span> <span class="n">rew</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ep_rews</span><span class="p">):</span>
                <span class="n">discounted_reward</span> <span class="o">=</span> <span class="n">rew</span> <span class="o">+</span> <span class="n">discounted_reward</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
                <span class="n">batch_rtgs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">discounted_reward</span><span class="p">)</span>

		<span class="c1"># Convert the rewards-to-go into a tensor</span>
        <span class="n">batch_rtgs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">batch_rtgs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">batch_rtgs</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Agent.compute_rtgs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_rtgs</span><span class="p">(</span><span class="n">batch_rews</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Given a batch of rewards , it calculates the discouted return for each state for that batch</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span> <span class="nf">compute_rtgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_rews</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a batch of rewards , it calculates the discouted return for each state for that batch&quot;&quot;&quot;</span>

        <span class="n">batch_rtgs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ep_rews</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">batch_rews</span><span class="p">):</span>
            <span class="n">discounted_reward</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># The discounted reward so far</span>
            <span class="k">for</span> <span class="n">rew</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ep_rews</span><span class="p">):</span>
                <span class="n">discounted_reward</span> <span class="o">=</span> <span class="n">rew</span> <span class="o">+</span> <span class="n">discounted_reward</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
                <span class="n">batch_rtgs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">discounted_reward</span><span class="p">)</span>

		<span class="c1"># Convert the rewards-to-go into a tensor</span>
        <span class="n">batch_rtgs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">batch_rtgs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">batch_rtgs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Agent.evaluate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">,</span> <span class="n">batch_acts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculates the value of the states, as well as the log probability af the actions that are taken.
The derivatives are calculated here.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_obs</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">,</span><span class="n">batch_acts</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculates the value of the states, as well as the log probability af the actions that are taken.</span>
<span class="sd">    The derivatives are calculated here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critic_network_</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_network_</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">)</span>
    <span class="c1"># dist = MultivariateNormal(mean, self.cov_mat)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_var</span><span class="p">)</span>
    <span class="n">log_probs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">V</span><span class="p">,</span> <span class="n">log_probs</span> 
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Agent.get_actions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_actions</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This method will draw the actions from a normal distribution around the actor netwrok prediction.
The derivatives are not calculated here.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">observation</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This method will draw the actions from a normal distribution around the actor netwrok prediction.</span>
<span class="sd">    The derivatives are not calculated here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_network_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
    <span class="c1"># dist = MultivariateNormal(mean, self.actor_var)(mean, self.cov_mat)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">actor_var</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="n">log_prob</span> <span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>        <span class="c1"># log_prob = dist.log_prob(action)</span>
    <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">log_prob</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="spamdfba.toolkit.Environment" class="doc doc-heading">
        <code>Environment</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>An environment is a collection of the following:
Agents: a list of objects of class Agent, defined below.
extracellular reactions: a list of dictionaries that describes reaction that happens outside of cells.
An example of such reactins is reactions catalyzed by extracellular enzymes. This list should look like this:
[{"reaction":{
    "a":1,
    "b":-1,
    "c":1
},
"kinetics": (lambda x,y: x*y,("a","b")),))},...]</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A descriptive name for the environment</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>agents</code></td>
          <td>
                <code><span title="typing.Iterable">Iterable</span></code>
          </td>
          <td><p>An iterable object like list or tuple including the collection of the agents to be used in the environment.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>extracellular_reactions</code></td>
          <td>
                <code><span title="typing.Iterable">Iterable</span></code>
          </td>
          <td><p>An iterable object consisting of a collection of extracellular reactions defined as above.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>initial_condition</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary describing the initial concentration of all species in the environment to be used in the beginning</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>inlet_conditions</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary describing the inlet concentration of all species in the environment to be used in the beginning</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>number_of_batches</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Determines how many batches are performed in a simulation</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>dt</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Specifies the time step for DFBA calculations</p></td>
          <td>
                <code>0.1</code>
          </td>
        </tr>
        <tr>
          <td><code>dilution_rate</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The dilution rate of the bioreactor in per hour unit.</p></td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>episodes_per_batch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Determines how many episodes should be executed with same actor function in parallel (policy evaluation)</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>episode_length</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Determines how many time points exists within a given episode.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>training</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to run in training mode. If false, no training happens.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>constant</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of components that we want to hold their concentration constant during the simulations.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spamdfba</span> <span class="kn">import</span> <span class="n">toymodels</span> <span class="k">as</span> <span class="n">tm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">spamdfba</span> <span class="kn">import</span> <span class="n">toolkit</span> <span class="k">as</span> <span class="n">tk</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent1</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;agent1&quot;</span><span class="p">,</span>
<span class="go">    model=tm.ToyModel_SA.copy(),</span>
<span class="go">    actor_network=tk.NN,</span>
<span class="go">    critic_network=tk.NN,</span>
<span class="go">    clip=0.1,</span>
<span class="go">    lr_actor=0.0001,</span>
<span class="go">    lr_critic=0.001,</span>
<span class="go">    grad_updates=4,</span>
<span class="go">    optimizer_actor=torch.optim.Adam,</span>
<span class="go">    optimizer_critic=torch.optim.Adam,</span>
<span class="go">    observables=[&#39;agent1&#39;,&#39;agent2&#39; ,&#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="go">    actions=[&quot;Amylase_e&quot;],</span>
<span class="go">    gamma=1,</span>
<span class="go">    )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent2</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;agent2&quot;</span><span class="p">,</span>
<span class="go">    model=tm.ToyModel_SA.copy(),</span>
<span class="go">    actor_network=tk.NN,</span>
<span class="go">    critic_network=tk.NN,</span>
<span class="go">    clip=0.1,</span>
<span class="go">    lr_actor=0.0001,</span>
<span class="go">    lr_critic=0.001,</span>
<span class="go">    grad_updates=4,</span>
<span class="go">    optimizer_actor=torch.optim.Adam,</span>
<span class="go">    optimizer_critic=torch.optim.Adam,</span>
<span class="go">    observables=[&#39;agent1&#39;,&#39;agent2&#39;, &#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="go">    actions=[&quot;Amylase_e&quot;],</span>
<span class="go">    gamma=1,</span>
<span class="go">    )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span><span class="n">agent2</span><span class="p">]</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Toy-Exoenzyme-Two-agents&quot;</span><span class="p">,</span>
<span class="go">        agents=agents,</span>
<span class="go">        dilution_rate=0.0001,</span>
<span class="go">        initial_condition={&quot;Glc&quot;:100,&quot;agent1&quot;:0.1,&quot;agent2&quot;:0.1,&quot;Starch&quot;:10},</span>
<span class="go">        inlet_conditions={&quot;Starch&quot;:10},</span>
<span class="go">        extracellular_reactions=[{&quot;reaction&quot;:{</span>
<span class="go">        &quot;Glc&quot;:10,</span>
<span class="go">        &quot;Starch&quot;:-0.1,},</span>
<span class="go">        &quot;kinetics&quot;: (tk.general_kinetic,(&quot;Glc&quot;,&quot;Amylase&quot;))}],</span>
<span class="go">               dt=0.1,</span>
<span class="go">               number_of_batches=1000,</span>
<span class="go">               episodes_per_batch=int(NUM_CORES/2),</span>
<span class="go">               )</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Environment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; An environment is a collection of the following:</span>
<span class="sd">        Agents: a list of objects of class Agent, defined below.</span>
<span class="sd">        extracellular reactions: a list of dictionaries that describes reaction that happens outside of cells.</span>
<span class="sd">        An example of such reactins is reactions catalyzed by extracellular enzymes. This list should look like this:</span>
<span class="sd">        [{&quot;reaction&quot;:{</span>
<span class="sd">            &quot;a&quot;:1,</span>
<span class="sd">            &quot;b&quot;:-1,</span>
<span class="sd">            &quot;c&quot;:1</span>
<span class="sd">        },</span>
<span class="sd">        &quot;kinetics&quot;: (lambda x,y: x*y,(&quot;a&quot;,&quot;b&quot;)),))},...]</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): A descriptive name for the environment</span>
<span class="sd">            agents (Iterable): An iterable object like list or tuple including the collection of the agents to be used in the environment.</span>
<span class="sd">            extracellular_reactions (Iterable): An iterable object consisting of a collection of extracellular reactions defined as above.</span>
<span class="sd">            initial_condition (dict): A dictionary describing the initial concentration of all species in the environment to be used in the beginning</span>
<span class="sd">            of each state</span>
<span class="sd">            inlet_conditions (dict): A dictionary describing the inlet concentration of all species in the environment to be used in the beginning</span>
<span class="sd">            of each state. This is important when simulating continuous bioreactors as the concentration of the inlet stream should be taken into account.</span>
<span class="sd">            number_of_batches (int): Determines how many batches are performed in a simulation</span>
<span class="sd">            dt (float): Specifies the time step for DFBA calculations</span>
<span class="sd">            dilution_rate (float): The dilution rate of the bioreactor in per hour unit.</span>
<span class="sd">            episodes_per_batch (int): Determines how many episodes should be executed with same actor function in parallel (policy evaluation)</span>
<span class="sd">            episode_length (int): Determines how many time points exists within a given episode.</span>
<span class="sd">            training (bool): Whether to run in training mode. If false, no training happens.</span>
<span class="sd">            constant (list): A list of components that we want to hold their concentration constant during the simulations.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from spamdfba import toymodels as tm</span>
<span class="sd">            &gt;&gt;&gt; from spamdfba import toolkit as tk</span>
<span class="sd">            &gt;&gt;&gt; agent1=tk.Agent(&quot;agent1&quot;,</span>
<span class="sd">                model=tm.ToyModel_SA.copy(),</span>
<span class="sd">                actor_network=tk.NN,</span>
<span class="sd">                critic_network=tk.NN,</span>
<span class="sd">                clip=0.1,</span>
<span class="sd">                lr_actor=0.0001,</span>
<span class="sd">                lr_critic=0.001,</span>
<span class="sd">                grad_updates=4,</span>
<span class="sd">                optimizer_actor=torch.optim.Adam,</span>
<span class="sd">                optimizer_critic=torch.optim.Adam,</span>
<span class="sd">                observables=[&#39;agent1&#39;,&#39;agent2&#39; ,&#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="sd">                actions=[&quot;Amylase_e&quot;],</span>
<span class="sd">                gamma=1,</span>
<span class="sd">                )</span>
<span class="sd">            &gt;&gt;&gt; agent2=tk.Agent(&quot;agent2&quot;,</span>
<span class="sd">                model=tm.ToyModel_SA.copy(),</span>
<span class="sd">                actor_network=tk.NN,</span>
<span class="sd">                critic_network=tk.NN,</span>
<span class="sd">                clip=0.1,</span>
<span class="sd">                lr_actor=0.0001,</span>
<span class="sd">                lr_critic=0.001,</span>
<span class="sd">                grad_updates=4,</span>
<span class="sd">                optimizer_actor=torch.optim.Adam,</span>
<span class="sd">                optimizer_critic=torch.optim.Adam,</span>
<span class="sd">                observables=[&#39;agent1&#39;,&#39;agent2&#39;, &#39;Glc&#39;, &#39;Starch&#39;],</span>
<span class="sd">                actions=[&quot;Amylase_e&quot;],</span>
<span class="sd">                gamma=1,</span>
<span class="sd">                )</span>
<span class="sd">            &gt;&gt;&gt; agents=[agent1,agent2]</span>

<span class="sd">            &gt;&gt;&gt; env=tk.Environment(name=&quot;Toy-Exoenzyme-Two-agents&quot;,</span>
<span class="sd">                    agents=agents,</span>
<span class="sd">                    dilution_rate=0.0001,</span>
<span class="sd">                    initial_condition={&quot;Glc&quot;:100,&quot;agent1&quot;:0.1,&quot;agent2&quot;:0.1,&quot;Starch&quot;:10},</span>
<span class="sd">                    inlet_conditions={&quot;Starch&quot;:10},</span>
<span class="sd">                    extracellular_reactions=[{&quot;reaction&quot;:{</span>
<span class="sd">                    &quot;Glc&quot;:10,</span>
<span class="sd">                    &quot;Starch&quot;:-0.1,},</span>
<span class="sd">                    &quot;kinetics&quot;: (tk.general_kinetic,(&quot;Glc&quot;,&quot;Amylase&quot;))}],</span>
<span class="sd">                           dt=0.1,</span>
<span class="sd">                           number_of_batches=1000,</span>
<span class="sd">                           episodes_per_batch=int(NUM_CORES/2),</span>
<span class="sd">                           )       </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                <span class="n">agents</span><span class="p">:</span><span class="n">Iterable</span><span class="p">,</span>
                <span class="n">extracellular_reactions</span><span class="p">:</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                <span class="n">initial_condition</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span>
                <span class="n">inlet_conditions</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span>
                <span class="n">number_of_batches</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">dt</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">dilution_rate</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">episodes_per_batch</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">episode_length</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                <span class="n">training</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">constant</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="p">[]</span>


                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="n">agents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_agents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extracellular_reactions</span> <span class="o">=</span> <span class="n">extracellular_reactions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="o">=</span><span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">episodes_per_batch</span><span class="o">=</span><span class="n">episodes_per_batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_batches</span><span class="o">=</span><span class="n">number_of_batches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dilution_rate</span> <span class="o">=</span> <span class="n">dilution_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">=</span><span class="n">training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_exchanges</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_species</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolve_extracellular_reactions</span><span class="p">(</span><span class="n">extracellular_reactions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">),))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">initial_condition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">=</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">),))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">inlet_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">=</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_observables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_networks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dict</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;episode&quot;</span><span class="p">:[]</span>
                        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">episode_length</span><span class="o">=</span><span class="n">episode_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">=</span><span class="p">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>




    <span class="k">def</span> <span class="nf">resolve_exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Determines the exchange reaction mapping for the community. This mapping is required to keep track of </span>
<span class="sd">        Metabolite pool change by relating exctacellular concentrations with production or consumption by the agents.&quot;&quot;&quot;</span>
        <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">model</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Build_Mapping_Matrix</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_species</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Determines the extracellular species in the community before extracellula reactions.&quot;&quot;&quot;</span>
        <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Ex_sp&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">species</span>

    <span class="k">def</span> <span class="nf">resolve_extracellular_reactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">extracellular_reactions</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Determines the extracellular reactions for the community. This method adds any new compounds required to run DFBA</span>
<span class="sd">        to the system.</span>
<span class="sd">        Args:</span>
<span class="sd">            extracellular_reactions list[dict]: list of extracellular reactions as defined in the constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">extracellular_reactions</span><span class="p">]</span>
        <span class="n">new_species</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">species</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_species</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The following species are not in the community: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_species</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_species</span><span class="p">)))</span>



    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Resets the environment to its initial state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">=</span><span class="p">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dict</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;episode&quot;</span><span class="p">:[]</span>
                        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Performs a single DFBA step in the environment.</span>
<span class="sd">        This method provides similar interface as other RL libraries: It returns:</span>
<span class="sd">        current state, rewards given to each agent from FBA calculations, actions each agent took,</span>
<span class="sd">        and next state calculated similar to DFBA.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_actions</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Sols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">M</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Ex_sp&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">upper_bound</span><span class="o">=</span><span class="mi">100</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=-</span><span class="n">M</span><span class="o">.</span><span class="n">general_uptake_kinetics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)])</span>


            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">flux</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">t_0</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
            <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_dict</span><span class="p">[</span><span class="s2">&quot;optimization&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reward</span><span class="o">=-</span><span class="mi">1</span>
                <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">objective_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span><span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">objective_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)):</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Sols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
                        <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">Sols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">]</span>
                                                    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="c1"># Handling extracellular reactions</span>

        <span class="k">for</span> <span class="n">ex_reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracellular_reactions</span><span class="p">:</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;kinetics&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;kinetics&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">metabolite</span> <span class="ow">in</span> <span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dCdt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">metabolite</span><span class="p">)]</span><span class="o">+=</span><span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">][</span><span class="n">metabolite</span><span class="p">]</span><span class="o">*</span><span class="n">rate</span>
        <span class="n">dCdt</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilution_rate</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+=</span> <span class="n">dCdt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

        <span class="n">Cp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">C</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">reward</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">a</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span><span class="n">Cp</span>


    <span class="k">def</span> <span class="nf">set_observables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sets the observables for the agents in the environment.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_networks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sets up the networks and optimizers for the agents in the environment.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">actor_network_</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">actor_network</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">actions</span><span class="p">))</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">critic_network_</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">critic_network</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_critic</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">critic_network_</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">lr_critic</span><span class="p">)</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_actor</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">actor_network_</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">lr_actor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.extract_species" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_species</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Determines the extracellular species in the community before extracellula reactions.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_species</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Determines the extracellular species in the community before extracellula reactions.&quot;&quot;&quot;</span>
    <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">]</span>
    <span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Ex_sp&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">species</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Resets the environment to its initial state.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Resets the environment to its initial state.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="o">=</span><span class="p">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
        <span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
        <span class="s2">&quot;episode&quot;</span><span class="p">:[]</span>
                    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.resolve_exchanges" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_exchanges</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Determines the exchange reaction mapping for the community. This mapping is required to keep track of 
Metabolite pool change by relating exctacellular concentrations with production or consumption by the agents.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resolve_exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Determines the exchange reaction mapping for the community. This mapping is required to keep track of </span>
<span class="sd">    Metabolite pool change by relating exctacellular concentrations with production or consumption by the agents.&quot;&quot;&quot;</span>
    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">model</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Build_Mapping_Matrix</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.resolve_extracellular_reactions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_extracellular_reactions</span><span class="p">(</span><span class="n">extracellular_reactions</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Determines the extracellular reactions for the community. This method adds any new compounds required to run DFBA
to the system.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>extracellular_reactions</code></td>
          <td>
                <code>list[dict]</code>
          </td>
          <td><p>list of extracellular reactions as defined in the constructor.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resolve_extracellular_reactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">extracellular_reactions</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Determines the extracellular reactions for the community. This method adds any new compounds required to run DFBA</span>
<span class="sd">    to the system.</span>
<span class="sd">    Args:</span>
<span class="sd">        extracellular_reactions list[dict]: list of extracellular reactions as defined in the constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">species</span><span class="o">=</span><span class="p">[]</span>
    <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">extracellular_reactions</span><span class="p">]</span>
    <span class="n">new_species</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">species</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_species</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The following species are not in the community: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_species</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_species</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.set_networks" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_networks</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sets up the networks and optimizers for the agents in the environment.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_networks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Sets up the networks and optimizers for the agents in the environment.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">actor_network_</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">actor_network</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">actions</span><span class="p">))</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">critic_network_</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">critic_network</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_critic</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">critic_network_</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">lr_critic</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_actor</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">actor_network_</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">lr_actor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.set_observables" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_observables</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Sets the observables for the agents in the environment.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_observables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Sets the observables for the agents in the environment.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Environment.step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">step</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Performs a single DFBA step in the environment.
This method provides similar interface as other RL libraries: It returns:
current state, rewards given to each agent from FBA calculations, actions each agent took,
and next state calculated similar to DFBA.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Performs a single DFBA step in the environment.</span>
<span class="sd">    This method provides similar interface as other RL libraries: It returns:</span>
<span class="sd">    current state, rewards given to each agent from FBA calculations, actions each agent took,</span>
<span class="sd">    and next state calculated similar to DFBA.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_actions</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">Sols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">M</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Ex_sp&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">upper_bound</span><span class="o">=</span><span class="mi">100</span>
                <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s1">&#39;Mapping_Matrix&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=-</span><span class="n">M</span><span class="o">.</span><span class="n">general_uptake_kinetics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)])</span>


        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">flux</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">M</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">lower_bound</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">t_0</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
        <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dict</span><span class="p">[</span><span class="s2">&quot;optimization&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reward</span><span class="o">=-</span><span class="mi">1</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">objective_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span><span class="n">Sols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">objective_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Sols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
                    <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dCdt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">Sols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">fluxes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping_matrix</span><span class="p">[</span><span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">]</span>
                                                <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

    <span class="c1"># Handling extracellular reactions</span>

    <span class="k">for</span> <span class="n">ex_reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracellular_reactions</span><span class="p">:</span>
        <span class="n">rate</span><span class="o">=</span><span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;kinetics&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;kinetics&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">metabolite</span> <span class="ow">in</span> <span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">metabolite</span><span class="p">)]</span><span class="o">+=</span><span class="n">ex_reaction</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">][</span><span class="n">metabolite</span><span class="p">]</span><span class="o">*</span><span class="n">rate</span>
    <span class="n">dCdt</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">dilution_rate</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
    <span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+=</span> <span class="n">dCdt</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span>

    <span class="n">Cp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">C</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">reward</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">a</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agents</span><span class="p">),</span><span class="n">Cp</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="spamdfba.toolkit.NN" class="doc doc-heading">
        <code>NN</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>

  
      <p>This class is a subclass of nn.Module and is a general class for defining function approximators in the RL problems.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_dim</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>dimension of the input, states, tensor.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>output_dim</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>dimension of the output tensor.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hidden_dim</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>dimension of each hidden layer, defults to 20.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>activation</code></td>
          <td>
          </td>
          <td><p>Type of the activation layer. Usually nn.Relu or nn.Tanh.</p></td>
          <td>
                <code>nn.ReLU</code>
          </td>
        </tr>
        <tr>
          <td><code>n_hidden</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of hidden layers in the neural network.</p></td>
          <td>
                <code>8</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is a subclass of nn.Module and is a general class for defining function approximators in the RL problems.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_dim (int): dimension of the input, states, tensor.</span>
<span class="sd">        output_dim (int): dimension of the output tensor.</span>
<span class="sd">        hidden_dim (int): dimension of each hidden layer, defults to 20.</span>
<span class="sd">        activation : Type of the activation layer. Usually nn.Relu or nn.Tanh.</span>
<span class="sd">        n_hidden (int): number of hidden layers in the neural network.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_dim</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">output_dim</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">hidden_dim</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span><span class="n">n_hidden</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlayer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span><span class="n">hidden_dim</span><span class="p">),</span><span class="n">activation</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span><span class="n">hidden_dim</span><span class="p">),</span><span class="n">activation</span><span class="p">()]</span><span class="o">*</span><span class="n">n_hidden</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span><span class="n">output_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inlayer</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="spamdfba.toolkit.Simulation" class="doc doc-heading">
        <code>Simulation</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This class is designed to run the final simulation for an environment and additionaly does:
- Saving the results given a specific interval
- Plotting the results 
- calculating the duration of different parts of the code.
This class can be extended easily later for added functionalities such as online streaming the training results.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A descriptive name given to the simulation. This name is used to save the training files.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>env</code></td>
          <td>
                <code>environment</code>
          </td>
          <td><p>The environment to perform the simulations in. </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The DIRECTORY to which you want to save the training results</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>overwrite</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Determines whether to overwrite the pickel in each saving interval create new files</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>report</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Includes the reported time at each step</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Simulation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is designed to run the final simulation for an environment and additionaly does:</span>
<span class="sd">        - Saving the results given a specific interval</span>
<span class="sd">        - Plotting the results </span>
<span class="sd">        - calculating the duration of different parts of the code.</span>
<span class="sd">        This class can be extended easily later for added functionalities such as online streaming the training results.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): A descriptive name given to the simulation. This name is used to save the training files.</span>
<span class="sd">            env (environment): The environment to perform the simulations in. </span>
<span class="sd">            save_dir (str): The DIRECTORY to which you want to save the training results</span>
<span class="sd">            overwrite (bool): Determines whether to overwrite the pickel in each saving interval create new files</span>
<span class="sd">            report (dict): Includes the reported time at each step</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">env</span><span class="p">:</span><span class="n">Environment</span><span class="p">,</span><span class="n">save_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">save_every</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">overwrite</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">=</span><span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_every</span><span class="o">=</span><span class="n">save_every</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">=</span><span class="p">{}</span>


    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">solver</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;glpk&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">initial_critic_error</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Environment</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method runs the training loop</span>

<span class="sd">        Args:</span>
<span class="sd">            solver (str): The solver to be used by cobrapy</span>
<span class="sd">            verbose (bool): whether to print the training results after each iteration</span>
<span class="sd">            initial_critic_error (float): To make the training faster this method first trains the critic network on the first batch of episodes to</span>
<span class="sd">            make the critic network produce more realistic values in the beginning. This parameter defines what is the allowable MSE of the critic network</span>
<span class="sd">            on the first batch of data obtained from the evironment</span>
<span class="sd">        Returns:</span>
<span class="sd">            Environment: The trained version of the environment.</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="n">t_0_sim</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:{</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;batch&quot;</span><span class="p">:[],</span>
            <span class="s2">&quot;simulation&quot;</span><span class="p">:[]</span>
        <span class="p">}</span>            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">solver</span><span class="o">=</span><span class="n">solver</span>

        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">number_of_batches</span><span class="p">):</span>
            <span class="n">batch_obs</span><span class="p">,</span><span class="n">batch_acts</span><span class="p">,</span> <span class="n">batch_log_probs</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">,</span><span class="n">batch_times</span><span class="p">,</span><span class="n">env_rew</span><span class="o">=</span><span class="n">rollout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;optimization&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;optimization&quot;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;returns&quot;</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env_rew</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="n">V</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>  
                <span class="n">A_k</span> <span class="o">=</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="n">V</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>       
                <span class="n">A_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">A_k</span> <span class="o">-</span> <span class="n">A_k</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">A_k</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>   
                <span class="k">if</span> <span class="n">batch</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hold on, bringing the creitc network to range ...&quot;</span><span class="p">)</span>
                        <span class="n">err</span><span class="o">=</span><span class="n">initial_critic_error</span><span class="o">+</span><span class="mi">1</span>
                        <span class="k">while</span> <span class="n">err</span><span class="o">&gt;</span><span class="n">initial_critic_error</span><span class="p">:</span>   
                            <span class="n">V</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>  
                            <span class="n">critic_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">V</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>   
                            <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>  
                            <span class="n">critic_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>  
                            <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>   
                            <span class="n">err</span><span class="o">=</span><span class="n">critic_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>  
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>   
                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">grad_updates</span><span class="p">):</span>                                                      

                        <span class="n">V</span><span class="p">,</span> <span class="n">curr_log_probs</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                        <span class="n">ratios</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">curr_log_probs</span> <span class="o">-</span> <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                        <span class="n">surr1</span> <span class="o">=</span> <span class="n">ratios</span> <span class="o">*</span> <span class="n">A_k</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
                        <span class="n">surr2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">ratios</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">clip</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">agent</span><span class="o">.</span><span class="n">clip</span><span class="p">)</span> <span class="o">*</span> <span class="n">A_k</span>
                        <span class="n">actor_loss</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">surr1</span><span class="p">,</span> <span class="n">surr2</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                        <span class="n">critic_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">V</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                        <span class="n">actor_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                        <span class="n">critic_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>                                                            

                <span class="k">if</span> <span class="n">batch</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">save_every</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_obs.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_acts.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>		
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;_obs.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;_acts.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2"> finished:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> return was:  </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">episodes_per_batch</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0_sim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_learning_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method plots the learning curve for all the agents.</span>
<span class="sd">        Args:</span>
<span class="sd">            plot (bool): whether to render the plot as well </span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure : Returns a plotly figure for learning curves of the agents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
            <span class="n">rets</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;returns&quot;</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">x</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">DEFAULT_PLOTLY_COLORS</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span>
                        <span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span><span class="o">+</span><span class="n">rets</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;toself&#39;</span><span class="p">,</span>
                        <span class="n">fillcolor</span><span class="o">=</span><span class="n">DEFAULT_PLOTLY_COLORS_BACK</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgba(255,255,255,0)&#39;</span><span class="p">),</span>
                        <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span>
                        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Batch&quot;</span>
                <span class="p">},</span>
                <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Total Episode Return&quot;</span>
                <span class="p">}</span>

            <span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">print_training_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">draw_table</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dictionary describing the simulation time at different level of the training process. You can also opt to draw a table based on this results </span>
<span class="sd">        using Rich library.</span>

<span class="sd">        Args:</span>
<span class="sd">            draw_table (bool): whether to draw the table in the console</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A list of dictionaries that contain duration of execution for different stages of simulation </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report_times</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;std&quot;</span><span class="p">},</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">draw_table</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulation times&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Level&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Mean(s)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;STD(s)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Optimization&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Batch&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Simulation&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="s2">&quot;NA&quot;</span><span class="p">)</span>
            <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">report_times</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Simulation.plot_learning_curves" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_learning_curves</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This method plots the learning curve for all the agents.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>plot</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to render the plot as well </p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="plotly.graph_objs">go</span>.<span title="plotly.graph_objs.Figure">Figure</span></code>
          </td>
          <td><p>go.Figure : Returns a plotly figure for learning curves of the agents.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_learning_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method plots the learning curve for all the agents.</span>
<span class="sd">    Args:</span>
<span class="sd">        plot (bool): whether to render the plot as well </span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure : Returns a plotly figure for learning curves of the agents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">agent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
        <span class="n">rets</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;returns&quot;</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="n">x</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">DEFAULT_PLOTLY_COLORS</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span>
                    <span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span><span class="o">+</span><span class="n">rets</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;toself&#39;</span><span class="p">,</span>
                    <span class="n">fillcolor</span><span class="o">=</span><span class="n">DEFAULT_PLOTLY_COLORS_BACK</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgba(255,255,255,0)&#39;</span><span class="p">),</span>
                    <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span>
                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Batch&quot;</span>
            <span class="p">},</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Total Episode Return&quot;</span>
            <span class="p">}</span>

        <span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Simulation.print_training_times" class="doc doc-heading">
<code class="highlight language-python"><span class="n">print_training_times</span><span class="p">(</span><span class="n">draw_table</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary describing the simulation time at different level of the training process. You can also opt to draw a table based on this results 
using Rich library.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>draw_table</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to draw the table in the console</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>list[dict]</code>
          </td>
          <td><p>A list of dictionaries that contain duration of execution for different stages of simulation</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">print_training_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">draw_table</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary describing the simulation time at different level of the training process. You can also opt to draw a table based on this results </span>
<span class="sd">    using Rich library.</span>

<span class="sd">    Args:</span>
<span class="sd">        draw_table (bool): whether to draw the table in the console</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A list of dictionaries that contain duration of execution for different stages of simulation </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report_times</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;std&quot;</span><span class="p">},</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">draw_table</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulation times&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Level&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Mean(s)&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;STD(s)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Optimization&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Batch&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]))</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Simulation&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">report_times</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span><span class="s2">&quot;NA&quot;</span><span class="p">)</span>
        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">report_times</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.toolkit.Simulation.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;glpk&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initial_critic_error</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This method runs the training loop</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>solver</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The solver to be used by cobrapy</p></td>
          <td>
                <code>&#39;glpk&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to print the training results after each iteration</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>initial_critic_error</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>To make the training faster this method first trains the critic network on the first batch of episodes to</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Environment</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="spamdfba.toolkit.Environment" href="#spamdfba.toolkit.Environment">Environment</a></code>
          </td>
          <td><p>The trained version of the environment.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">solver</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;glpk&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">initial_critic_error</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Environment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method runs the training loop</span>

<span class="sd">    Args:</span>
<span class="sd">        solver (str): The solver to be used by cobrapy</span>
<span class="sd">        verbose (bool): whether to print the training results after each iteration</span>
<span class="sd">        initial_critic_error (float): To make the training faster this method first trains the critic network on the first batch of episodes to</span>
<span class="sd">        make the critic network produce more realistic values in the beginning. This parameter defines what is the allowable MSE of the critic network</span>
<span class="sd">        on the first batch of data obtained from the evironment</span>
<span class="sd">    Returns:</span>
<span class="sd">        Environment: The trained version of the environment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">t_0_sim</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:{</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
        <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
        <span class="s2">&quot;batch&quot;</span><span class="p">:[],</span>
        <span class="s2">&quot;simulation&quot;</span><span class="p">:[]</span>
    <span class="p">}</span>            
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">solver</span><span class="o">=</span><span class="n">solver</span>

    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">number_of_batches</span><span class="p">):</span>
        <span class="n">batch_obs</span><span class="p">,</span><span class="n">batch_acts</span><span class="p">,</span> <span class="n">batch_log_probs</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">,</span><span class="n">batch_times</span><span class="p">,</span><span class="n">env_rew</span><span class="o">=</span><span class="n">rollout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;optimization&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;optimization&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;returns&quot;</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env_rew</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">V</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>  
            <span class="n">A_k</span> <span class="o">=</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="n">V</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>       
            <span class="n">A_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">A_k</span> <span class="o">-</span> <span class="n">A_k</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">A_k</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>   
            <span class="k">if</span> <span class="n">batch</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hold on, bringing the creitc network to range ...&quot;</span><span class="p">)</span>
                    <span class="n">err</span><span class="o">=</span><span class="n">initial_critic_error</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">while</span> <span class="n">err</span><span class="o">&gt;</span><span class="n">initial_critic_error</span><span class="p">:</span>   
                        <span class="n">V</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>  
                        <span class="n">critic_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">V</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>   
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>  
                        <span class="n">critic_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>  
                        <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>   
                        <span class="n">err</span><span class="o">=</span><span class="n">critic_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>  
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>   
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">grad_updates</span><span class="p">):</span>                                                      

                    <span class="n">V</span><span class="p">,</span> <span class="n">curr_log_probs</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">ratios</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">curr_log_probs</span> <span class="o">-</span> <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">surr1</span> <span class="o">=</span> <span class="n">ratios</span> <span class="o">*</span> <span class="n">A_k</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
                    <span class="n">surr2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">ratios</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">clip</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">agent</span><span class="o">.</span><span class="n">clip</span><span class="p">)</span> <span class="o">*</span> <span class="n">A_k</span>
                    <span class="n">actor_loss</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">surr1</span><span class="p">,</span> <span class="n">surr2</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="n">critic_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">V</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                    <span class="n">actor_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_policy_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                    <span class="n">critic_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">optimizer_value_</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>                                                            

            <span class="k">if</span> <span class="n">batch</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">save_every</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_obs.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_acts.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>		
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;_obs.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;_acts.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch</span><span class="si">}</span><span class="s2"> finished:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> return was:  </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">episodes_per_batch</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0_sim</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.Build_Mapping_Matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">Build_Mapping_Matrix</span><span class="p">(</span><span class="n">models</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given a list of COBRA model objects, this function will build a mapping matrix for all the exchange reactions.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">Build_Mapping_Matrix</span><span class="p">(</span><span class="n">models</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="n">cobra</span><span class="o">.</span><span class="n">Model</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of COBRA model objects, this function will build a mapping matrix for all the exchange reactions.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Ex_sp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Ex_rxns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="n">Ex_rxns</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">model</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">]</span><span class="o">.</span><span class="n">metabolites</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">rxn</span><span class="p">)</span> <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">exchange_reactions</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">rxn</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_e&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rxn</span><span class="o">!=</span><span class="n">model</span><span class="o">.</span><span class="n">biomass_ind</span><span class="p">])</span>
    <span class="n">Ex_sp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Ex_rxns</span><span class="p">]))</span>
    <span class="n">Mapping_Matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Ex_sp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)),</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">Ex_rxns</span><span class="p">:</span>
        <span class="n">Mapping_Matrix</span><span class="p">[</span><span class="n">Ex_sp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">models</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">=</span><span class="n">record</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Ex_sp&quot;</span><span class="p">:</span> <span class="n">Ex_sp</span><span class="p">,</span> <span class="s2">&quot;Mapping_Matrix&quot;</span><span class="p">:</span> <span class="n">Mapping_Matrix</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.general_kinetic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">general_kinetic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A simple function implementing MM kinetics</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">general_kinetic</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple function implementing MM kinetics &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">+</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.general_uptake" class="doc doc-heading">
<code class="highlight language-python"><span class="n">general_uptake</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>An extremely simple function for mass transfer kinetic. Only used for testing</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">general_uptake</span><span class="p">(</span><span class="n">c</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An extremely simple function for mass transfer kinetic. Only used for testing &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.mass_transfer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mass_transfer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A simple function for mass transfer kinetic</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mass_transfer</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">k</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple function for mass transfer kinetic &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.rollout" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rollout</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs a batch calculation in parallel using Ray library.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>env</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="spamdfba.toolkit.Environment" href="#spamdfba.toolkit.Environment">Environment</a></code>
          </td>
          <td><p>The environment instance to run the episodes for</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rollout</span><span class="p">(</span><span class="n">env</span><span class="p">:</span><span class="n">Environment</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a batch calculation in parallel using Ray library.</span>
<span class="sd">    Args:</span>
<span class="sd">        env (Environment): The environment instance to run the episodes for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t0_batch</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">batch_obs</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_acts</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_log_probs</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_rews</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_rtgs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_times</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;step&quot;</span><span class="p">:[],</span>
                 <span class="s2">&quot;episode&quot;</span><span class="p">:[],</span>
                 <span class="s2">&quot;optimization&quot;</span><span class="p">:[],</span>
                 <span class="s2">&quot;batch&quot;</span><span class="p">:[]}</span>

    <span class="n">batch</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">episodes_per_batch</span><span class="p">):</span>
        <span class="c1"># batch.append(run_episode_single(env))</span>
        <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_episode</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
    <span class="n">batch</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">episodes_per_batch</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
            <span class="n">batch_obs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">batch_acts</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="n">batch_rews</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s2">&quot;step&quot;</span><span class="p">])</span>
        <span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;episode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s2">&quot;episode&quot;</span><span class="p">])</span>
        <span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;optimization&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="n">ep</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="s2">&quot;optimization&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">batch_rews</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>

        <span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">batch_obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">batch_acts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">batch_log_probs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">batch_rtgs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">compute_rtgs</span><span class="p">(</span><span class="n">batch_rews</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> 
    <span class="n">batch_times</span><span class="p">[</span><span class="s2">&quot;batch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0_batch</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch_obs</span><span class="p">,</span><span class="n">batch_acts</span><span class="p">,</span> <span class="n">batch_log_probs</span><span class="p">,</span> <span class="n">batch_rtgs</span><span class="p">,</span><span class="n">batch_times</span><span class="p">,</span><span class="n">env</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.run_episode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_episode</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Runs a single episode of the environment used for parallel computatuon of episodes.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">run_episode</span><span class="p">(</span><span class="n">env</span><span class="p">:</span><span class="n">Environment</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Runs a single episode of the environment used for parallel computatuon of episodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t_0_ep</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">batch_obs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_acts</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_log_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">episode_rews</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">episode_len</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">episode_length</span>
    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">episode_len</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">episode_len</span><span class="o">-</span><span class="n">ep</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>   
            <span class="n">action</span><span class="p">,</span> <span class="n">log_prob</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_actions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">],</span><span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="n">action</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> 
        <span class="n">t_0_step</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sp</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">time_dict</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0_step</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">ag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
            <span class="n">batch_obs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">observables</span><span class="p">],</span><span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">batch_acts</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ag</span><span class="o">.</span><span class="n">log_prob</span><span class="p">)</span>
            <span class="n">episode_rews</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="n">env</span><span class="o">.</span><span class="n">time_dict</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0_step</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">time_dict</span><span class="p">[</span><span class="s2">&quot;episode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t_0_ep</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch_obs</span><span class="p">,</span><span class="n">batch_acts</span><span class="p">,</span> <span class="n">batch_log_probs</span><span class="p">,</span> <span class="n">episode_rews</span><span class="p">,</span><span class="n">env</span><span class="o">.</span><span class="n">time_dict</span><span class="p">,</span><span class="n">env</span><span class="o">.</span><span class="n">rewards</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="spamdfba.toolkit.run_episode_single" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_episode_single</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Runs a single episode of the environment.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/toolkit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_episode_single</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Runs a single episode of the environment.&quot;&quot;&quot;</span>
    <span class="n">batch_obs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_acts</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">batch_log_probs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">episode_rews</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">}</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">episode_len</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">episode_length</span>
    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">episode_len</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">episode_len</span><span class="o">-</span><span class="n">ep</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">:</span>   
            <span class="n">action</span><span class="p">,</span> <span class="n">log_prob</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_actions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">obs</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">observables</span><span class="p">],</span><span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="n">action</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span> <span class="o">.</span><span class="n">detach</span><span class="p">()</span>        
        <span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">sp</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">ag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">agents</span><span class="p">):</span>
            <span class="n">batch_obs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">observables</span><span class="p">],</span><span class="n">env</span><span class="o">.</span><span class="n">t</span><span class="p">]))</span>
            <span class="n">batch_acts</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">batch_log_probs</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ag</span><span class="o">.</span><span class="n">log_prob</span><span class="p">)</span>
            <span class="n">episode_rews</span><span class="p">[</span><span class="n">ag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">batch_obs</span><span class="p">,</span><span class="n">batch_acts</span><span class="p">,</span> <span class="n">batch_log_probs</span><span class="p">,</span> <span class="n">episode_rews</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="toymodel">toymodel</h2>
<p>This module includes all the predefined cobra models that are used in the case studies</p>
<pre><code>from cobra import Model, Reaction, Metabolite
import cobra
import numpy as np
&quot;&quot;&quot;
A Toy Model is a Cobra Model with the following:

Toy_Model_SA

Reactions(NOT BALANCED):

-&gt; S  Substrate uptake
S + ADP -&gt; S_x + ATP  ATP production from catabolism
ATP -&gt; ADP ATP maintenance
S_x + ATP -&gt; X + ADP  Biomass production
S_x + ATP -&gt; Amylase + ADP  Amylase production
Amylase -&gt; Amylase Exchange
X -&gt; Biomass Out
S_x + ADP -&gt; P + ATP Metabolism stuff!
P -&gt;  Product release

Metabolites:

P  Product
S  Substrate
S_x  Internal metabolite
X  Biomass
ADP  
ATP
Amylase

-----------------------------------------------------------------------


Toy_Model_NE_Aux_1:


EX_S_sp1: S -&gt; lowerBound',-10,'upperBound',0
EX_A_sp1: A -&gt; lowerBound',-100,'upperBound',100
EX_B_sp1: B -&gt; lowerBound',-100,'upperBound',100
EX_P_sp1: P-&gt;  lowerBound',0,'upperBound',100
R_1_sp1: S  + 2 adp  -&gt; P + 2 atp ,'lowerBound',0,'upperBound',Inf
R_2_sp1: P + atp  -&gt; B  + adp 'lowerBound',0,'upperBound',Inf
R_3_sp1: P + 3 atp  -&gt; A + 3 adp ,'lowerBound',0,'upperBound',Inf
R_4_sp1: 'atp -&gt; adp  lowerBound',0,'upperBound',Inf
OBJ_sp1: 3 A + 3 B + 5 atp  -&gt; 5 adp + biomass_sp1 lowerBound',0,'upperBound',Inf
Biomass_1 biomass_sp1  -&gt; ','lowerBound',0,'upperBound',Inf,'objectiveCoef', 1);





Toy_Model_NE_Aux_2:


EX_S_sp1: S -&gt; lowerBound',-10,'upperBound',0
EX_A_sp1: A -&gt; lowerBound',-100,'upperBound',100
EX_B_sp1: B -&gt; lowerBound',-100,'upperBound',100
EX_P_sp1: P-&gt;  lowerBound',0,'upperBound',100
R_1_sp1: S  + 2 adp  -&gt; P + 2 atp ,'lowerBound',0,'upperBound',Inf
R_2_sp1: P + atp  -&gt; B  + adp 'lowerBound',0,'upperBound',Inf
R_3_sp1: P + 3 atp  -&gt; A + 3 adp ,'lowerBound',0,'upperBound',Inf
R_4_sp1: 'atp -&gt; adp  lowerBound',0,'upperBound',Inf
OBJ_sp1: 3 A + 3 B + 5 atp  -&gt; 5 adp + biomass_sp1 lowerBound',0,'upperBound',Inf
Biomass_1 biomass_sp1  -&gt; ','lowerBound',0,'upperBound',Inf,'objectiveCoef', 1);

&quot;&quot;&quot;
ToyModel_SA = Model('Toy_Model')

### S_Uptake ###

S_Uptake = Reaction('Glc_e')
S = Metabolite('Glc', compartment='c')
S_Uptake.add_metabolites({S: -1})
S_Uptake.lower_bound = -20
S_Uptake.upper_bound = 0
ToyModel_SA.add_reactions([S_Uptake])

### ADP Production From Catabolism ###

ATP_Cat = Reaction('ATP_Cat')
ADP = Metabolite('ADP', compartment='c')
ATP = Metabolite('ATP', compartment='c')
S_x = Metabolite('S_x', compartment='c')
ATP_Cat.add_metabolites({ADP: -1, S: -1, S_x: 1, ATP: 1})
ATP_Cat.lower_bound = 0
ATP_Cat.upper_bound = 1000
ToyModel_SA.add_reactions([ATP_Cat])

### ATP Maintenance ###

ATP_M = Reaction('ATP_M')
ATP_M.add_metabolites({ATP: -1, ADP: 1})
ATP_M.lower_bound = 1
ATP_M.upper_bound = 100
ToyModel_SA.add_reactions([ATP_M])

### Biomass Production ###

X = Metabolite('X', compartment='c')
X_Production = Reaction('X_Production')
X_Production.add_metabolites({S_x: -1, ATP: -100, ADP: 100, X: 1})
X_Production.lower_bound = 0
X_Production.upper_bound = 1000
ToyModel_SA.add_reactions([X_Production])

### Biomass Release ###

X_Release = Reaction('X_Ex')
X_Release.add_metabolites({X: -1})
X_Release.lower_bound = 0
X_Release.upper_bound = 1000
ToyModel_SA.add_reactions([X_Release])

### Metabolism stuff ###

P = Metabolite('P', compartment='c')
P_Prod = Reaction('P_Prod')
P_Prod.add_metabolites({S_x: -1, ATP: 1, ADP: -1, P: 0.1})
P_Prod.lower_bound = 0
P_Prod.upper_bound = 1000
ToyModel_SA.add_reactions([P_Prod])

### Product Release ###

P_out = Reaction('P_e')
P_out.add_metabolites({P: -1})
P_out.lower_bound = 0
P_out.upper_bound = 1000
ToyModel_SA.add_reactions([P_out])
ToyModel_SA.objective = 'X_Ex'

### Amylase Production ###
Amylase_Prod = Reaction('Amylase_Prod')
Amylase = Metabolite('Amylase', compartment='c')
Amylase_Prod.add_metabolites({S_x: -1, ATP: -1, ADP: 1, Amylase: 0.1})
Amylase_Prod.lower_bound = 0
Amylase_Prod.upper_bound = 1000
ToyModel_SA.add_reactions([Amylase_Prod])

### Amylase Exchange ###
Amylase_Ex = Reaction('Amylase_e')
Amylase_Ex.add_metabolites({Amylase: -1})
Amylase_Ex.lower_bound = 0
Amylase_Ex.upper_bound = 1000
ToyModel_SA.add_reactions([Amylase_Ex])

ToyModel_SA.biomass_ind=4
ToyModel_SA.exchange_reactions=tuple([ToyModel_SA.reactions.index(i) for i in ToyModel_SA.exchanges])



#########################################################
#########################################################

### S_Uptake ###
Toy_Model_NE_Aux_1 = Model('Toy_1_Aux')

EX_S_sp1 = Reaction('S_e')
S = Metabolite('S', compartment='c')
EX_S_sp1.add_metabolites({S: -1})
EX_S_sp1.lower_bound = -10
EX_S_sp1.upper_bound = 0
Toy_Model_NE_Aux_1.add_reactions([EX_S_sp1])


EX_A_sp1 = Reaction('A_e')
A = Metabolite('A', compartment='c')
EX_A_sp1.add_metabolites({A: -1})
EX_A_sp1.lower_bound = -100
EX_A_sp1.upper_bound = 100
Toy_Model_NE_Aux_1.add_reactions([EX_A_sp1])


EX_B_sp1 = Reaction('B_e')
B = Metabolite('B', compartment='c')
EX_B_sp1.add_metabolites({B: -1})
EX_B_sp1.lower_bound = -100
EX_B_sp1.upper_bound = 100
Toy_Model_NE_Aux_1.add_reactions([EX_B_sp1])



EX_P_sp1 = Reaction('P_e')
P = Metabolite('P', compartment='c')
EX_P_sp1.add_metabolites({P:-1})
EX_P_sp1.lower_bound = 0
EX_P_sp1.upper_bound = 100
Toy_Model_NE_Aux_1.add_reactions([EX_P_sp1])


R_1_sp1 = Reaction('R_1_sp1')
ADP = Metabolite('ADP', compartment='c')
ATP = Metabolite('ATP', compartment='c')
R_1_sp1.add_metabolites({ADP: -2, S: -1, P: 1, ATP: 2})
R_1_sp1.lower_bound = 0
R_1_sp1.upper_bound = 1000
Toy_Model_NE_Aux_1.add_reactions([R_1_sp1])


R_2_sp1 = Reaction('R_2_sp1')
R_2_sp1.add_metabolites({ADP: 1, P: -1, B: 3, ATP: -1})
R_2_sp1.lower_bound = 0
R_2_sp1.upper_bound = 1000
Toy_Model_NE_Aux_1.add_reactions([R_2_sp1])


# R_3_sp1 = Reaction('R_3_sp1')
# R_3_sp1.add_metabolites({ADP: 3, P: -1, A: 1, ATP: -3})
# R_3_sp1.lower_bound = 0
# R_3_sp1.upper_bound = 1000
# Toy_Model_NE_Aux_1.add_reactions([R_3_sp1])



R_4_sp1 = Reaction('R_4_sp1')
R_4_sp1.add_metabolites({ADP:1 ,ATP: -1})
R_4_sp1.lower_bound = 0
R_4_sp1.upper_bound = 1000
Toy_Model_NE_Aux_1.add_reactions([R_4_sp1])


OBJ_sp1 = Reaction(&quot;OBJ_sp1&quot;)
biomass_sp1 = Metabolite('biomass_sp1', compartment='c')
OBJ_sp1.add_metabolites({ADP:5 ,ATP: -5,biomass_sp1:0.1,A:-5,B:-5})
OBJ_sp1.lower_bound = 0
OBJ_sp1.upper_bound = 1000
Toy_Model_NE_Aux_1.add_reactions([OBJ_sp1])

Biomass_1 = Reaction(&quot;Biomass_1&quot;)
Biomass_1.add_metabolites({biomass_sp1:-1})
Biomass_1.lower_bound = 0
Biomass_1.upper_bound = 1000
Toy_Model_NE_Aux_1.add_reactions([Biomass_1])

Toy_Model_NE_Aux_1.objective='Biomass_1'
Toy_Model_NE_Aux_1.biomass_ind=8
Toy_Model_NE_Aux_1.exchange_reactions=tuple([Toy_Model_NE_Aux_1.reactions.index(i) for i in Toy_Model_NE_Aux_1.exchanges])


### ADP Production From Catabolism ###

Toy_Model_NE_Aux_2 = Model('Toy_2_Aux')

### S_Uptake ###

EX_S_sp2 = Reaction('S_e')
S = Metabolite('S', compartment='c')
EX_S_sp2.add_metabolites({S: -1})
EX_S_sp2.lower_bound = -10
EX_S_sp2.upper_bound = 0
Toy_Model_NE_Aux_2.add_reactions([EX_S_sp2])


EX_A_sp2 = Reaction('A_e')
A = Metabolite('A', compartment='c')
EX_A_sp2.add_metabolites({A: -1})
EX_A_sp2.lower_bound = -100
EX_A_sp2.upper_bound = 100
Toy_Model_NE_Aux_2.add_reactions([EX_A_sp2])


EX_B_sp2 = Reaction('B_e')
B = Metabolite('B', compartment='c')
EX_B_sp2.add_metabolites({B: -1})
EX_B_sp2.lower_bound = -100
EX_B_sp2.upper_bound = 100
Toy_Model_NE_Aux_2.add_reactions([EX_B_sp2])



EX_P_sp2 = Reaction('P_e')
P = Metabolite('P', compartment='c')
EX_P_sp2.add_metabolites({P:-1})
EX_P_sp2.lower_bound = 0
EX_P_sp2.upper_bound = 100
Toy_Model_NE_Aux_2.add_reactions([EX_P_sp2])


R_1_sp2 = Reaction('R_1_sp2')
ADP = Metabolite('ADP', compartment='c')
ATP = Metabolite('ATP', compartment='c')
R_1_sp2.add_metabolites({ADP: -2, S: -1, P: 1, ATP: 2})
R_1_sp2.lower_bound = 0
R_1_sp2.upper_bound = 1000
Toy_Model_NE_Aux_2.add_reactions([R_1_sp2])


# R_2_sp2 = Reaction('R_2_sp2')
# R_2_sp2.add_metabolites({ADP: 3, P: -1, B: 1, ATP: -3})
# R_2_sp2.lower_bound = 0
# R_2_sp2.upper_bound = 1000
# Toy_Model_NE_Aux_2.add_reactions([R_2_sp2])


R_3_sp2 = Reaction('R_3_sp2')
R_3_sp2.add_metabolites({ADP: 1, P: -1, A: 3, ATP: -1})
R_3_sp2.lower_bound = 0
R_3_sp2.upper_bound = 1000
Toy_Model_NE_Aux_2.add_reactions([R_3_sp2])



R_4_sp2 = Reaction('R_4_sp2')
R_4_sp2.add_metabolites({ADP:1 ,ATP: -1})
R_4_sp2.lower_bound = 0
R_4_sp2.upper_bound = 1000
Toy_Model_NE_Aux_2.add_reactions([R_4_sp2])




OBJ_sp2 = Reaction(&quot;OBJ_sp2&quot;)
biomass_sp2 = Metabolite('biomass_sp2', compartment='c')
OBJ_sp2.add_metabolites({ADP:5 ,ATP: -5,biomass_sp2:0.1,A:-5,B:-5})
OBJ_sp2.lower_bound = 0
OBJ_sp2.upper_bound = 1000
Toy_Model_NE_Aux_2.add_reactions([OBJ_sp2])

Biomass_2 = Reaction(&quot;Biomass_2&quot;)
Biomass_2.add_metabolites({biomass_sp2:-1})
Biomass_2.lower_bound = 0
Biomass_2.upper_bound = 1000
Toy_Model_NE_Aux_2.add_reactions([Biomass_2])
Toy_Model_NE_Aux_2.objective=&quot;Biomass_2&quot;
Toy_Model_NE_Aux_2.biomass_ind=8
Toy_Model_NE_Aux_2.exchange_reactions=tuple([Toy_Model_NE_Aux_2.reactions.index(i) for i in Toy_Model_NE_Aux_2.exchanges])



########################## Mutualistic Species ##########################

### S_Uptake ###
Toy_Model_NE_Mut_1 = Model('Toy_1_Mut')

EX_S_sp1 = Reaction('S_e')
S = Metabolite('S', compartment='c')
EX_S_sp1.add_metabolites({S: -1})
EX_S_sp1.lower_bound = -10
EX_S_sp1.upper_bound = 0
Toy_Model_NE_Mut_1.add_reactions([EX_S_sp1])


EX_A_sp1 = Reaction('A_e')
A = Metabolite('A', compartment='c')
EX_A_sp1.add_metabolites({A: -1})
EX_A_sp1.lower_bound = -100
EX_A_sp1.upper_bound = 100
Toy_Model_NE_Mut_1.add_reactions([EX_A_sp1])


EX_B_sp1 = Reaction('B_e')
B = Metabolite('B', compartment='c')
EX_B_sp1.add_metabolites({B: -1})
EX_B_sp1.lower_bound = -100
EX_B_sp1.upper_bound = 100
Toy_Model_NE_Mut_1.add_reactions([EX_B_sp1])



EX_P_sp1 = Reaction('P_e')
P = Metabolite('P', compartment='c')
EX_P_sp1.add_metabolites({P:-1})
EX_P_sp1.lower_bound = 0
EX_P_sp1.upper_bound = 100
Toy_Model_NE_Mut_1.add_reactions([EX_P_sp1])


R_1_sp1 = Reaction('R_1_sp1')
ADP = Metabolite('ADP', compartment='c')
ATP = Metabolite('ATP', compartment='c')
R_1_sp1.add_metabolites({ADP: -2, S: -1, P: 1, ATP: 2})
R_1_sp1.lower_bound = 0
R_1_sp1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([R_1_sp1])


R_2_sp1 = Reaction('R_2_sp1')
R_2_sp1.add_metabolites({ADP: 1, P: -1, B: 3, ATP: -1})
R_2_sp1.lower_bound = 0
R_2_sp1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([(R_2_sp1)])


R_3_sp1 = Reaction('R_3_sp1')
R_3_sp1.add_metabolites({ADP: 3, P: -1, A: 1, ATP: -3})
R_3_sp1.lower_bound = 0
R_3_sp1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([R_3_sp1])



R_4_sp1 = Reaction('R_4_sp1')
R_4_sp1.add_metabolites({ADP:1 ,ATP: -1})
R_4_sp1.lower_bound = 0
R_4_sp1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([R_4_sp1])


OBJ_sp1 = Reaction(&quot;OBJ_sp1&quot;)
biomass_sp1 = Metabolite('biomass_sp1', compartment='c')
OBJ_sp1.add_metabolites({ADP:5 ,ATP: -5,biomass_sp1:0.1,A:-5,B:-5})
OBJ_sp1.lower_bound = 0
OBJ_sp1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([OBJ_sp1])

Biomass_1 = Reaction(&quot;Biomass_1&quot;)
Biomass_1.add_metabolites({biomass_sp1:-1})
Biomass_1.lower_bound = 0
Biomass_1.upper_bound = 1000
Toy_Model_NE_Mut_1.add_reactions([Biomass_1])

Toy_Model_NE_Mut_1.objective='Biomass_1'
Toy_Model_NE_Mut_1.biomass_ind=9
Toy_Model_NE_Mut_1.exchange_reactions=tuple([Toy_Model_NE_Mut_1.reactions.index(i) for i in Toy_Model_NE_Mut_1.exchanges])



Toy_Model_NE_Mut_2 = Model('Toy_2_Mut')

EX_S_sp2 = Reaction('S_e')
S = Metabolite('S', compartment='c')
EX_S_sp2.add_metabolites({S: -1})
EX_S_sp2.lower_bound = -10
EX_S_sp2.upper_bound = 0
Toy_Model_NE_Mut_2.add_reactions([EX_S_sp2])


EX_A_sp2 = Reaction('A_e')
A = Metabolite('A', compartment='c')
EX_A_sp2.add_metabolites({A: -1})
EX_A_sp2.lower_bound = -100
EX_A_sp2.upper_bound = 100
Toy_Model_NE_Mut_2.add_reactions([EX_A_sp2])


EX_B_sp2 = Reaction('B_e')
B = Metabolite('B', compartment='c')
EX_B_sp2.add_metabolites({B: -1})
EX_B_sp2.lower_bound = -100
EX_B_sp2.upper_bound = 100
Toy_Model_NE_Mut_2.add_reactions([EX_B_sp2])


EX_P_sp2 = Reaction('P_e')
P = Metabolite('P', compartment='c')
EX_P_sp2.add_metabolites({P:-1})
EX_P_sp2.lower_bound = 0
EX_P_sp2.upper_bound = 100
Toy_Model_NE_Mut_2.add_reactions([EX_P_sp2])


R_1_sp2 = Reaction('R_1_sp2')
ADP = Metabolite('ADP', compartment='c')
ATP = Metabolite('ATP', compartment='c')
R_1_sp2.add_metabolites({ADP: -2, S: -1, P: 1, ATP: 2})
R_1_sp2.lower_bound = 0
R_1_sp2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([R_1_sp2])


R_2_sp2 = Reaction('R_2_sp2')
R_2_sp2.add_metabolites({ADP: 1, P: -1, B: 3, ATP: -1})
R_2_sp2.lower_bound = 0
R_2_sp2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([(R_2_sp2)])

R_3_sp2 = Reaction('R_3_sp2')
R_3_sp2.add_metabolites({ADP: 3, P: -1, A: 1, ATP: -3})
R_3_sp2.lower_bound = 0
R_3_sp2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([R_3_sp2])

R_4_sp2 = Reaction('R_4_sp2')
R_4_sp2.add_metabolites({ADP:1 ,ATP: -1})
R_4_sp2.lower_bound = 0
R_4_sp2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([R_4_sp2])

OBJ_sp2 = Reaction(&quot;OBJ_sp2&quot;)
biomass_sp2 = Metabolite('biomass_sp2', compartment='c')
OBJ_sp2.add_metabolites({ADP:5 ,ATP: -5,biomass_sp2:0.1,A:-5,B:-5})
OBJ_sp2.lower_bound = 0
OBJ_sp2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([OBJ_sp2])

Biomass_2 = Reaction(&quot;Biomass_2&quot;)
Biomass_2.add_metabolites({biomass_sp2:-1})
Biomass_2.lower_bound = 0
Biomass_2.upper_bound = 1000
Toy_Model_NE_Mut_2.add_reactions([Biomass_2])

Toy_Model_NE_Mut_2.objective='Biomass_2'
Toy_Model_NE_Mut_2.biomass_ind=9
Toy_Model_NE_Mut_2.exchange_reactions=tuple([Toy_Model_NE_Mut_2.reactions.index(i) for i in Toy_Model_NE_Mut_2.exchanges])

</code></pre>
<h2 id="stats">Stats</h2>


<div class="doc doc-object doc-module">


<a id="spamdfba.stats"></a>
  <div class="doc doc-contents first">
  
      <p>This module is designed for statistical analysis of the simulation results.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="spamdfba.stats.StatResult" class="doc doc-heading">
        <code>StatResult</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This class is designed for presenting the results of statistical analyses offered by this, stats, module.
Two vectors of observations are required to be compared. They can vary in size but it would be strange if this 
is the case with SPAM-DFBA simulations.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vec1</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>First vector of observations.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>vec2</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Second vector of observations.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>names</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>Names of the two vectors in the same order as they are passed as vec1 and vec2.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>spamdfba/stats.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StatResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is designed for presenting the results of statistical analyses offered by this, stats, module.</span>
<span class="sd">    Two vectors of observations are required to be compared. They can vary in size but it would be strange if this </span>
<span class="sd">    is the case with SPAM-DFBA simulations.</span>

<span class="sd">    Args:</span>
<span class="sd">        vec1 (np.ndarray): First vector of observations.</span>
<span class="sd">        vec2 (np.ndarray): Second vector of observations.</span>
<span class="sd">        names (list[str]): Names of the two vectors in the same order as they are passed as vec1 and vec2.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">vec2</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vec1</span> <span class="o">=</span> <span class="n">vec1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vec2</span> <span class="o">=</span> <span class="n">vec2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">box_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A simple box plot visualization of the two vectors of observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">vec1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">vec2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obs1&#39;</span><span class="p">,</span><span class="s1">&#39;obs2&#39;</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">anova</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs one-way ANOVA test on the two vectors of observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vec1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vec2</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ares</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anova</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    mean1:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mean1</span><span class="si">}</span>
<span class="s2">    mean2:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mean2</span><span class="si">}</span>
<span class="s2">    std1:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std1</span><span class="si">}</span>
<span class="s2">    std2:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std2</span><span class="si">}</span>
<span class="s2">    -------------------</span>
<span class="s2">    ANOVA: statistic=</span><span class="si">{</span><span class="n">ares</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, pvalue=</span><span class="si">{</span><span class="n">ares</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="spamdfba.stats.StatResult.anova" class="doc doc-heading">
<code class="highlight language-python"><span class="n">anova</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Performs one-way ANOVA test on the two vectors of observations.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/stats.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">anova</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs one-way ANOVA test on the two vectors of observations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vec1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vec2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="spamdfba.stats.StatResult.box_plot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">box_plot</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A simple box plot visualization of the two vectors of observations.</p>

      <details class="quote">
        <summary>Source code in <code>spamdfba/stats.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">box_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple box plot visualization of the two vectors of observations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">vec1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">vec2</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obs1&#39;</span><span class="p">,</span><span class="s1">&#39;obs2&#39;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="spamdfba.stats.compare_observations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compare_observations</span><span class="p">(</span><span class="n">obs1</span><span class="p">,</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">compounds</span><span class="p">,</span> <span class="n">on_index</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="s1">&#39;agent1&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs statistical analysis of two batches of observations.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>obs1</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>address of the first batch of observations save as .pkl file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>obs2</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>address of the second batch of observations save as .pkl file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>compounds</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>List of compounds to compare.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>on_index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Index of the compound to compare.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="spamdfba.stats.StatResult" href="#spamdfba.stats.StatResult">StatResult</a></code>
          </td>
          <td><p>Statistical analysis results represented as a StatResult object.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>spamdfba/stats.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_observations</span><span class="p">(</span>
                        <span class="n">obs1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                        <span class="n">obs2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                        <span class="n">compounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                        <span class="n">on_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                        <span class="n">agent</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;agent1&#39;</span><span class="p">,</span>
                        <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">StatResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs statistical analysis of two batches of observations.</span>
<span class="sd">    Args:</span>
<span class="sd">        obs1: address of the first batch of observations save as .pkl file.</span>
<span class="sd">        obs2: address of the second batch of observations save as .pkl file.</span>
<span class="sd">        compounds: List of compounds to compare.</span>
<span class="sd">        on_index: Index of the compound to compare.</span>
<span class="sd">    Returns:</span>
<span class="sd">        (StatResult): Statistical analysis results represented as a StatResult object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">obs1</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">obs1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">obs2</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">obs2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="n">results</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">obs1</span><span class="o">=</span><span class="n">obs1</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
    <span class="n">obs2</span><span class="o">=</span><span class="n">obs2</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>
    <span class="n">obs1</span><span class="o">=</span><span class="n">obs1</span><span class="p">[:,</span><span class="n">compounds</span><span class="p">]</span>
    <span class="n">obs2</span><span class="o">=</span><span class="n">obs2</span><span class="p">[:,</span><span class="n">compounds</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compounds</span><span class="p">)):</span>
        <span class="n">temp1</span><span class="o">=</span><span class="n">obs1</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">on_index</span><span class="p">,:]</span>
        <span class="n">temp2</span><span class="o">=</span><span class="n">obs2</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="n">on_index</span><span class="p">,:]</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatResult</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span><span class="n">temp2</span><span class="p">,[</span><span class="s2">&quot;obs1&quot;</span><span class="p">,</span><span class="s2">&quot;obs2&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="scalability">Scalability</h2>
<p>Although SPAM-DFBA needs a large number of simulations for learning purpose, the simulation times scale linearly with the number of agents that are added. A survey on single, two, and five agent environment for starch-amylase case, see "Case Study - Starch Amylase", revealed this aspect which is shown below:</p>
<p><img alt="runtime" src="../runtime.png" /></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>